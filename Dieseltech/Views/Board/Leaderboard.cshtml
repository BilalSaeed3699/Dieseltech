
@{
    ViewBag.Title = "Leaderboard";


    double AvgProfit = 0.0d;
}

<head>
    <style>


        div#tblBroker_filter {
            position: sticky;
            top: 0;
            padding: 5px;
            z-index: 100;
            background: darkblue;
            color: white !important;
            width: 21.5% !important;
        }

        div#tblBroker_length {
            position: sticky !important;
            top: 0 !important;
            padding: 5px !important;
            z-index: 100 !important;
            background: darkblue !important;
            color: white !important;
            width: 78.5% !important;
            height: 51px !important;
        }

        thead {
            position: sticky !important;
            top: 50px !important;
            z-index: 100 !important;
        }

        select {
            color: white !important;
        }

        option {
            color: black !important;
        }

        input[type="search"] {
            color: white !important;
        }

        /*label {
            color: white !important
        }*/
    </style>

</head>


<div class="content">
    <div class="row">
        <div class="col-sm-2 col-3">
            <h4 class="page-title">Leader Board <a href="#"><i onclick="RefereshList()" class="fa fa-refresh"></i></a></h4>
            <span style="color:red;" id="fademsg">@ViewBag.error</span>
        </div>
        <div class="col-md-2">

            <select id="ddlyear" required name="ddlyear" onchange="ReloadList()" class="form-control js-example-basic-single">
                @*<option selected value="0">Select Year</option>*@
                @foreach (var item in ViewBag.ddlYears)
                {

                    <text>

                        @if (item.Value == Convert.ToString(@ViewBag.CurrentYear))
                        {
                            <option selected value="@item.Value">@item.Value</option>
                        }
                        else
                        {
                            <option value="@item.Value">@item.Value</option>
                        }


                    </text>
                }
            </select>
        </div>

        <div class="col-md-2">

            <select id="ddlmonth" required name="ddlmonth" onchange="ReloadList()" class="form-control js-example-basic-single">
                <option selected value="0">All Months</option>
                @foreach (var item in ViewBag.Days)
                {
                    
                    <text>
                        @if (item.ID == Convert.ToString(@ViewBag.CurrentMonth))
                        {
                            <option selected value="@item.ID">@item.Day</option>
                        }
                        else
                        {
                            <option value="@item.ID">@item.Day</option>
                        }


                    </text>
                }

            </select>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12">
            <div class="table-responsive" style="max-height: 700px !important;">
                @*<table class="table table-border table-striped custom-table  g-dataTable mb-0">*@

                <table style="font-size: 12px; width: 99.9%;" class="table table-condensed table-fit table-sm table-striped g-dataTable  mb-0" id="tblBroker">
                    <thead>
                        <tr>
                            <th hidden>Carrier ID </th>
                            <th>Agent Name </th>
                            @*<th>Customer Name </th>*@
                            <th>Total Load </th>
                            <th>Total Profit </th>
                            <th>Average Profit Margin </th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in @ViewBag.LoaderBoard)
                        {
                        <tr>
                            <td hidden>@item.User_ID</td>
                            <td>@item.UserName</td>
                            @*<td>@item.Name</td>*@
                            <td>  @item.TotalLoads   </td>
                            <td> @Convert.ToInt64(@item.Profit) </td>
                            @{ 
                                AvgProfit = Convert.ToDouble(@item.Profit / item.TotalLoads);
                            }
                            <td> @AvgProfit.ToString("0.00") </td>


                        </tr>
                        }


                    </tbody>
                </table>
            </div>
        </div>
    </div>


    @*<div class="row">
            @foreach (var item in @ViewBag.LoaderBoard)
            {
                <div class="col-md-6 col-sm-6 col-lg-6 col-xl-3">
                    <h5 style="font-weight:Bold">@item.CarrierName (@item.AssignID)</h5>
                    <div class="dash-widget" style="background-color: #7a92a3">
                        <span class="dash-widget-bg1" style="background-color:transparent"><i class="fa fa-user" aria-hidden="true"></i></span>
                        <div class="dash-widget-info text-right">
                            <h3 style="color:white" id="DispatcherName"> Total Loads @item.TotalLoads</h3>
                            <span style="font-size: 14px;background-color: white;color: #7a92a3;font-weight: bold" class="widget-title1">
                                Total Profit    @Convert.ToInt32(@item.Profit)

                            </span>
                        </div>
                    </div>
                </div>
            }
        </div>*@
</div>

<script>
    jQuery(document).ready(function () {
        jQuery('#ddlyear').select2();
        jQuery('#ddlmonth').select2();

        $('#tblBroker').DataTable({

            "fixedHeader": true,
            "columnDefs": [
                {
                    "orderable": false,
                    "render": $.fn.dataTable.render.number(',', '.', 2, ''),
                    "targets": [3, 4],
                }
            ],
        });
    });
    function RefereshList() {
        location.reload();
    }


     function ReloadList() {
         var checkajax = 1;
         var year =$("#ddlyear").val();
         var month = $("#ddlmonth").val();

         if (year == null) {
             year = 0;
         }
         if (month == null) {
             month = 0;
         }
         var model = {
             ddlyear: year,
             ddlmonth: month,
             CheckAjax: checkajax
         };

         $.ajax({
            url: '@Url.Action("ReloadLeaderBoard", "Board")',
            type: "POST",
             data: JSON.stringify(model),
             contentType: "application/json; charset=utf-8",
             dataType: "json",
              success: function (result) {
                  window.location = result.url;
              }
        });
    }
</script>